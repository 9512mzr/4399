(function (win) {
    
    var PasswordForm = function ($el) { 
        CommonForm.apply(this, arguments);
    };
    $.extend(PasswordForm.prototype, CommonForm.prototype, {
        initCheckField: function () { 
            var self = this;
            this.$el.find('input').each(function () {
                if (this.name == 'old_password') {
                    var _Field = self.addCheckField(this);
                    _Field.onCheck('blur', function (v) {
                        if (v.length == 0) return '请输入登录密码';

                    });
                }
                if (this.name == 'password') self.attachPasswordCheck(this, 'password2');
                if (this.name == 'password2') self.attachPasswordCheck(this, 'password');
                if (this.name == 'mobile') self.attachMobileCheck(this);
            });
        },
        events: function () {
            var  self= this;
            self.refreshCaptcha();
            this.$el.on('click', '#mobile-captcha',self.refreshCaptcha );
            self.getCode();
            this.$el.on('submit', 'form', function () {
                var that = this;

                if (!self.checkForm()) return false;
                $.post(this.action, $(this).serializeArray(), 'json')
                    .done(function (res) {
                        if (res.errcode == 0) {

                            layer.config({
                              skin: 'demo-class'
                            });

                         layer.confirm('恭喜您,密码修改成功！', {
                              btn: ['确定','取消'] //按钮
                            }, function(){
                              window.location.href = 'http://passport.21cnjy.com/site/logout';
                            }, function(){
                              window.location.href = 'http://passport.21cnjy.com/site/logout';
                            }); 
                        }
                        else {
                            if (typeof res.data !== 'undefined') {
                                self.cache[res.data].showError(res.message);
                            }
                        }
                    })
                    .fail(function () { alert('异常，更改失败') })
                    .always(function () {  });
                return false;
            });
        }
    });
    
    win.PasswordForm = PasswordForm;
})(window);